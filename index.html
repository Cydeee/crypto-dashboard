<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Block A ¬∑ Price / Volatility / Trend</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-50 text-[13px] leading-5">
<div class="max-w-4xl mx-auto p-4 space-y-6">

  <h1 class="text-2xl font-bold">üü¶ Block A ‚Äî Price ¬∑ Volatility ¬∑ Trend</h1>

  <div id="cards" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4"></div>

  <p id="status" class="text-gray-500"></p>
</div>

<script>
/* ---------- 0 ¬∑ CONFIG ---------- */
const SYMBOL  = 'BINANCE:BTCUSDT';
const TOKEN   = 'd1t6tipr01qh0t056ib0d1t6tipr01qh0t056ibg';   // ‚Üê your Finnhub key
const TF      = { '15 m':15, '1 h':60, '4 h':240, '1 d':'D' };
const POLL_MS = 60_000;

/* ---------- 1 ¬∑ BUILD CARDS ---------- */
const wrap = document.getElementById('cards');
for (const tf in TF){
  wrap.insertAdjacentHTML('beforeend',`
    <div class="bg-white rounded shadow p-3 space-y-1">
      <h3 class="font-medium mb-1">${tf}</h3>
      <div>EMA-50       <span id="${tf}-ema50">‚Ä¶</span></div>
      <div>EMA-200      <span id="${tf}-ema200">‚Ä¶</span></div>
      <div>RSI-14       <span id="${tf}-rsi">‚Ä¶</span></div>
      <div>BB width %   <span id="${tf}-bb">‚Ä¶</span></div>
      <div>ATR/Close % <span id="${tf}-atr">‚Ä¶</span></div>
    </div>`);
}

/* ---------- 2 ¬∑ FINNHUB HELPER ---------- */
async function indi(ind,res,extra={}){
  const url = new URL('https://finnhub.io/api/v1/indicator');
  const now = Math.floor(Date.now()/1000);
  const back = (res==='D'?86400:res*60)*220;          // ~220 candles
  url.search = new URLSearchParams({
    symbol:SYMBOL, resolution:res, indicator:ind,
    from:now-back, to:now, token:TOKEN, ...extra
  });
  const r = await fetch(url);
  return r.ok ? r.json() : {};
}
const fmt = (v,p=2)=>v==null?'‚ö†Ô∏è':(+v).toFixed(p);

/* ---------- 3 ¬∑ POLLER ---------- */
async function poll(){
  for (const [label,res] of Object.entries(TF)){
    try{
      const [e50,e200,rsi,bb,atr] = await Promise.all([
        indi('ema',res,{timeperiod:50}),
        indi('ema',res,{timeperiod:200}),
        indi('rsi',res,{timeperiod:14}),
        indi('bbands',res,{timeperiod:20}),
        indi('atr',res,{timeperiod:14})
      ]);
      const ema50 = e50.EMA?.at(-1);
      const ema200= e200.EMA?.at(-1);
      const rsiV  = rsi.RSI?.at(-1);
      const up=bb.upper?.at(-1), low=bb.lower?.at(-1), close=bb.close?.at(-1);
      const bbW = up&&low&&close?(((up-low)/close)*100).toFixed(2):null;
      const atrV = atr.ATR?.at(-1);
      const atrP = atrV&&close?((atrV/close)*100).toFixed(2):null;

      [['ema50',ema50],['ema200',ema200],['rsi',rsiV],
       ['bb',bbW],['atr',atrP]].forEach(([k,v])=>{
        document.getElementById(`${label}-${k}`).textContent =
          fmt(v,k==='rsi'?1:2);
      });
    }catch(err){ console.error('Block A',label,err); }
  }
  document.getElementById('status').textContent =
    'Last refresh '+new Date().toLocaleTimeString();
}

/* ---------- 4 ¬∑ START ---------- */
poll(); setInterval(poll, POLL_MS);
</script>
</body>
</html>
